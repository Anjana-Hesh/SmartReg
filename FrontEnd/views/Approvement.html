<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Driver License Applications</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
:root {
    --primary: #4e73df;
    --glass-bg: rgba(255, 255, 255, 0.08);
    --glass-border: rgba(255, 255, 255, 0.15);
    --text-light: #f5f5f5;
    --text-muted: rgba(255, 255, 255, 0.65);
}

body {
    background: linear-gradient(135deg, #141e30, #243b55);
    color: var(--text-light);
    font-family: "Segoe UI", Tahoma, sans-serif;
    min-height: 100vh;
}

.glass-card {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(12px);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.3);
    animation: fadeIn 0.4s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.table-glass {
    color: var(--text-light);
    border-collapse: separate;
    border-spacing: 0 8px;
}

.table-glass th {
    background: rgba(255, 255, 255, 0.1);
    border: none;
}

.table-glass td {
    background: rgba(255, 255, 255, 0.05);
    border: none;
    vertical-align: middle;
}

.table-glass tr:hover td {
    background: rgba(255, 255, 255, 0.12);
    transition: background 0.3s;
}

.photo-thumbnail {
    width: 45px;
    height: 45px;
    border-radius: 6px;
    object-fit: cover;
    cursor: pointer;
    border: 1px solid var(--glass-border);
    transition: transform 0.3s;
}

.photo-thumbnail:hover { transform: scale(1.08); }

.pdf-icon {
    color: #ff6b6b;
    font-size: 1.4rem;
    cursor: pointer;
    transition: transform 0.3s;
}

.pdf-icon:hover { transform: scale(1.15); }

.btn-approve {
    background: rgba(46, 204, 113, 0.2);
    border: 1px solid rgba(46, 204, 113, 0.4);
    color: #2ecc71;
    border-radius: 25px;
    padding: 4px 12px;
    transition: all 0.3s ease;
}
.btn-approve:hover {
    background: rgba(46, 204, 113, 0.35);
    color: white;
}

.btn-decline {
    background: rgba(231, 76, 60, 0.2);
    border: 1px solid rgba(231, 76, 60, 0.4);
    color: #e74c3c;
    border-radius: 25px;
    padding: 4px 12px;
    transition: all 0.3s ease;
}
.btn-decline:hover {
    background: rgba(231, 76, 60, 0.35);
    color: white;
}

.status-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.status-pending { background: rgba(241,196,15,0.2); color: #f1c40f; }
.status-approved { background: rgba(46,204,113,0.2); color: #2ecc71; }
.status-rejected { background: rgba(231,76,60,0.2); color: #e74c3c; }

.modal-content {
    background: rgba(30, 35, 50, 0.9);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(10px);
    color: var(--text-light);
}

.collapse-row {
    background: rgba(255, 255, 255, 0.05);
    padding: 10px;
}

.search-box {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--glass-border);
    color: white;
    border-radius: 25px;
    padding: 8px 15px;
    transition: all 0.3s;
}

.search-box:focus {
    background: rgba(255, 255, 255, 0.15);
    color: white;
    box-shadow: none;
    border-color: var(--primary);
}

.filter-dropdown .dropdown-menu {
    background: rgba(30, 35, 50, 0.95);
    border: 1px solid var(--glass-border);
}

.filter-dropdown .dropdown-item {
    color: var(--text-light);
}

.filter-dropdown .dropdown-item:hover {
    background: var(--primary);
}

.pagination .page-link {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    color: var(--text-light);
}

.pagination .page-link:hover {
    background: rgba(255, 255, 255, 0.1);
}

.pagination .active .page-link {
    background: var(--primary);
    border-color: var(--primary);
}

.rotate-icon {
    transition: transform 0.3s;
}

.rotate-icon.rotated {
    transform: rotate(180deg);
}

.empty-state {
    text-align: center;
    padding: 40px 0;
    color: var(--text-muted);
}

.empty-state i {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.5;
}

.dropdown-toggle::after {
    display: none;
}

.chevron-cell {
    width: 40px;
    cursor: pointer;
}

.action-cell {
    white-space: nowrap;
}
</style>
</head>
<body>

<div class="container py-5">
    <div class="glass-card">
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
            <h3 class="mb-3 mb-md-0"><i class="fas fa-id-card me-2"></i>Driver License Applications</h3>
            <div class="d-flex">
                <div class="input-group me-3" style="width: 250px;">
                    <span class="input-group-text bg-transparent border-end-0"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control search-box border-start-0" placeholder="Search..." id="searchInput">
                </div>
                <div class="filter-dropdown">
                    <button class="btn btn-outline-light dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-filter me-1"></i>Filter
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="filterDropdown">
                        <li><h6 class="dropdown-header">Status</h6></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="status" data-value="all">All Applications</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="status" data-value="pending"><span class="status-badge status-pending me-2">Pending</span>Pending</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="status" data-value="approved"><span class="status-badge status-approved me-2">Approved</span>Approved</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="status" data-value="rejected"><span class="status-badge status-rejected me-2">Rejected</span>Rejected</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><h6 class="dropdown-header">License Type</h6></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="license" data-value="all">All Types</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="license" data-value="learner">Learner</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="license" data-value="full">Full</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="license" data-value="international">International</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-glass align-middle">
                <thead>
                    <tr>
                        <th class="chevron-cell"></th>
                        <th>Driver Name</th>
                        <th>License Type</th>
                        <th>Language</th>
                        <th>Status</th>
                        <th>Submitted</th>
                        <th class="action-cell">Actions</th>
                    </tr>
                </thead>
                <tbody id="applicationsTable">
                    <!-- Application 1 -->
                    <tr>
                        <td class="chevron-cell" data-bs-toggle="collapse" data-bs-target="#details1" aria-expanded="false">
                            <i class="fas fa-chevron-down rotate-icon"></i>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="https://randomuser.me/api/portraits/men/32.jpg" class="rounded-circle me-2" width="30" height="30">
                                <span>John Doe</span>
                            </div>
                        </td>
                        <td>Full</td>
                        <td>English</td>
                        <td><span class="status-badge status-pending">Pending</span></td>
                        <td>2023-07-15</td>
                        <td class="action-cell">
                            <button class="btn btn-sm btn-approve me-1 approve-btn" data-id="1"><i class="fas fa-check"></i> Approve</button>
                            <button class="btn btn-sm btn-decline decline-btn" data-id="1"><i class="fas fa-times"></i> Decline</button>
                        </td>
                    </tr>
                    <tr class="collapse" id="details1">
                        <td colspan="7" class="collapse-row">
                            <div class="row">
                                <div class="col-md-4">
                                    <strong>Vehicle Classes:</strong> <span class="badge bg-primary me-1">B</span> <span class="badge bg-primary">C1</span><br>
                                    <strong>NIC:</strong> 987654321V<br>
                                    <strong>DOB:</strong> 1990-05-15<br>
                                    <strong>Blood Group:</strong> O+
                                </div>
                                <div class="col-md-4">
                                    <strong>Phone:</strong> +94 77 123 4567<br>
                                    <strong>Email:</strong> john.doe@example.com<br>
                                    <strong>Address:</strong> 123 Main St, Colombo
                                </div>
                                <div class="col-md-2 text-center">
                                    <strong>Photo</strong><br>
                                    <img src="https://randomuser.me/api/portraits/men/32.jpg" class="photo-thumbnail mt-1"
                                         data-bs-toggle="modal" data-bs-target="#photoModal"
                                         data-photo="https://randomuser.me/api/portraits/men/32.jpg">
                                </div>
                                <div class="col-md-2 text-center">
                                    <strong>Documents</strong><br>
                                    <i class="fas fa-file-pdf pdf-icon mt-1 me-2"
                                       data-bs-toggle="modal" data-bs-target="#pdfModal"
                                       data-pdf="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf"></i>
                                    <i class="fas fa-file-pdf pdf-icon mt-1"
                                       data-bs-toggle="modal" data-bs-target="#pdfModal"
                                       data-pdf="https://www.africau.edu/images/default/sample.pdf"></i>
                                </div>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Application 2 -->
                    <tr>
                        <td class="chevron-cell" data-bs-toggle="collapse" data-bs-target="#details2" aria-expanded="false">
                            <i class="fas fa-chevron-down rotate-icon"></i>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="https://randomuser.me/api/portraits/women/44.jpg" class="rounded-circle me-2" width="30" height="30">
                                <span>Jane Smith</span>
                            </div>
                        </td>
                        <td>Learner</td>
                        <td>Sinhala</td>
                        <td><span class="status-badge status-approved">Approved</span></td>
                        <td>2023-07-10</td>
                        <td class="action-cell">
                            <button class="btn btn-sm btn-approve me-1 approve-btn" data-id="2" disabled><i class="fas fa-check"></i> Approve</button>
                            <button class="btn btn-sm btn-decline decline-btn" data-id="2" disabled><i class="fas fa-times"></i> Decline</button>
                        </td>
                    </tr>
                    <tr class="collapse" id="details2">
                        <td colspan="7" class="collapse-row">
                            <div class="row">
                                <div class="col-md-4">
                                    <strong>Vehicle Classes:</strong> <span class="badge bg-primary me-1">B</span><br>
                                    <strong>NIC:</strong> 876543219V<br>
                                    <strong>DOB:</strong> 1995-08-22<br>
                                    <strong>Blood Group:</strong> A-
                                </div>
                                <div class="col-md-4">
                                    <strong>Phone:</strong> +94 76 987 6543<br>
                                    <strong>Email:</strong> jane.smith@example.com<br>
                                    <strong>Address:</strong> 456 Oak Ave, Kandy
                                </div>
                                <div class="col-md-2 text-center">
                                    <strong>Photo</strong><br>
                                    <img src="https://randomuser.me/api/portraits/women/44.jpg" class="photo-thumbnail mt-1"
                                         data-bs-toggle="modal" data-bs-target="#photoModal"
                                         data-photo="https://randomuser.me/api/portraits/women/44.jpg">
                                </div>
                                <div class="col-md-2 text-center">
                                    <strong>Documents</strong><br>
                                    <i class="fas fa-file-pdf pdf-icon mt-1 me-2"
                                       data-bs-toggle="modal" data-bs-target="#pdfModal"
                                       data-pdf="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf"></i>
                                </div>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Application 3 -->
                    <tr>
                        <td class="chevron-cell" data-bs-toggle="collapse" data-bs-target="#details3" aria-expanded="false">
                            <i class="fas fa-chevron-down rotate-icon"></i>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="https://randomuser.me/api/portraits/men/67.jpg" class="rounded-circle me-2" width="30" height="30">
                                <span>Robert Johnson</span>
                            </div>
                        </td>
                        <td>International</td>
                        <td>English</td>
                        <td><span class="status-badge status-rejected">Rejected</span></td>
                        <td>2023-07-05</td>
                        <td class="action-cell">
                            <button class="btn btn-sm btn-approve me-1 approve-btn" data-id="3" disabled><i class="fas fa-check"></i> Approve</button>
                            <button class="btn btn-sm btn-decline decline-btn" data-id="3" disabled><i class="fas fa-times"></i> Decline</button>
                        </td>
                    </tr>
                    <tr class="collapse" id="details3">
                        <td colspan="7" class="collapse-row">
                            <div class="row">
                                <div class="col-md-4">
                                    <strong>Vehicle Classes:</strong> <span class="badge bg-primary me-1">B</span> <span class="badge bg-primary">D</span><br>
                                    <strong>NIC:</strong> 765432198V<br>
                                    <strong>DOB:</strong> 1985-11-30<br>
                                    <strong>Blood Group:</strong> B+
                                </div>
                                <div class="col-md-4">
                                    <strong>Phone:</strong> +94 71 456 7890<br>
                                    <strong>Email:</strong> robert.j@example.com<br>
                                    <strong>Address:</strong> 789 Pine Rd, Galle
                                </div>
                                <div class="col-md-2 text-center">
                                    <strong>Photo</strong><br>
                                    <img src="https://randomuser.me/api/portraits/men/67.jpg" class="photo-thumbnail mt-1"
                                         data-bs-toggle="modal" data-bs-target="#photoModal"
                                         data-photo="https://randomuser.me/api/portraits/men/67.jpg">
                                </div>
                                <div class="col-md-2 text-center">
                                    <strong>Documents</strong><br>
                                    <i class="fas fa-file-pdf pdf-icon mt-1 me-2"
                                       data-bs-toggle="modal" data-bs-target="#pdfModal"
                                       data-pdf="https://www.africau.edu/images/default/sample.pdf"></i>
                                    <i class="fas fa-file-pdf pdf-icon mt-1"
                                       data-bs-toggle="modal" data-bs-target="#pdfModal"
                                       data-pdf="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf"></i>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div class="d-flex justify-content-between align-items-center mt-3">
                <div class="text-muted">
                    Showing <span id="showingFrom">1</span> to <span id="showingTo">3</span> of <span id="totalItems">3</span> applications
                </div>
                <nav>
                    <ul class="pagination">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Photo Modal -->
<div class="modal fade" id="photoModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Driver Photo</h5>
                <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img id="enlargedPhoto" class="img-fluid rounded" style="max-height: 70vh;">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- PDF Modal -->
<div class="modal fade" id="pdfModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Document Viewer</h5>
                <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <iframe id="pdfViewer" width="100%" height="600px" style="border:none;"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalTitle">Confirm Action</h5>
                <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="confirmModalBody">
                Are you sure you want to perform this action?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmActionBtn">Confirm</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    
$(document).ready(function() {
    // Initialize modals
    const photoModal = new bootstrap.Modal(document.getElementById('photoModal'));
    const pdfModal = new bootstrap.Modal(document.getElementById('pdfModal'));
    const confirmModal = new bootstrap.Modal(document.getElementById('confirmModal'));
    
    let currentAction = null;
    let currentApplicationId = null;
    
    // Photo modal handler
    $('#photoModal').on('show.bs.modal', function(e) {
        const photoUrl = $(e.relatedTarget).data('photo');
        $('#enlargedPhoto').attr('src', photoUrl);
    });
    
    // PDF modal handler
    $('#pdfModal').on('show.bs.modal', function(e) {
        const pdfUrl = $(e.relatedTarget).data('pdf');
        $('#pdfViewer').attr('src', pdfUrl + "#toolbar=0");
    });
    
    // Chevron click handler - only for expanding/collapsing
    $('.chevron-cell').on('click', function(e) {
        // Prevent event bubbling to parent elements
        e.stopPropagation();
        
        // Toggle the chevron icon
        $(this).find('.rotate-icon').toggleClass('rotated');
        
        // Let Bootstrap handle the collapse/expand
    });
    
    // Approve button click handler
    $(document).on('click', '.approve-btn:not(:disabled)', function(e) {
        e.stopPropagation();
        currentApplicationId = $(this).data('id');
        currentAction = 'approve';
        
        $('#confirmModalTitle').text('Approve Application');
        $('#confirmModalBody').html(`
            <p>Are you sure you want to approve this driver license application?</p>
            <div class="alert alert-success mt-3">
                <i class="fas fa-info-circle me-2"></i>
                This action will grant the applicant their requested license.
            </div>
        `);
        $('#confirmActionBtn').removeClass('btn-danger').addClass('btn-success').html('<i class="fas fa-check me-1"></i> Approve');
        confirmModal.show();
    });
    
    // Decline button click handler
    $(document).on('click', '.decline-btn:not(:disabled)', function(e) {
        e.stopPropagation();
        currentApplicationId = $(this).data('id');
        currentAction = 'decline';
        
        $('#confirmModalTitle').text('Decline Application');
        $('#confirmModalBody').html(`
            <p>Are you sure you want to decline this driver license application?</p>
            <div class="alert alert-danger mt-3">
                <i class="fas fa-exclamation-triangle me-2"></i>
                This action cannot be undone. The applicant will need to submit a new application.
            </div>
        `);
        $('#confirmActionBtn').removeClass('btn-success').addClass('btn-danger').html('<i class="fas fa-times me-1"></i> Decline');
        confirmModal.show();
    });
    
    // Confirm action button handler
    $('#confirmActionBtn').on('click', function() {
        if (currentAction && currentApplicationId) {
            const row = $(`.approve-btn[data-id="${currentApplicationId}"]`).closest('tr');
            const statusBadge = row.find('.status-badge');
            const actionButtons = row.find('.approve-btn, .decline-btn');
            
            if (currentAction === 'approve') {
                // Update status badge
                statusBadge.removeClass('status-pending status-rejected').addClass('status-approved').text('Approved');
                
                // Disable action buttons
                actionButtons.prop('disabled', true);
                
                // Update the status in the details row if expanded
                const detailsRow = row.next('.collapse');
                if (detailsRow.length) {
                    detailsRow.find('.status-badge').removeClass('status-pending status-rejected').addClass('status-approved').text('Approved');
                }
                
                showToast('success', 'Application Approved', 'The driver license application has been approved successfully.');
            } else if (currentAction === 'decline') {
                // Update status badge
                statusBadge.removeClass('status-pending status-approved').addClass('status-rejected').text('Rejected');
                
                // Disable action buttons
                actionButtons.prop('disabled', true);
                
                // Update the status in the details row if expanded
                const detailsRow = row.next('.collapse');
                if (detailsRow.length) {
                    detailsRow.find('.status-badge').removeClass('status-pending status-approved').addClass('status-rejected').text('Rejected');
                }
                
                showToast('error', 'Application Declined', 'The driver license application has been declined.');
            }
            
            confirmModal.hide();
        }
    });
    
    // Enhanced toast notification function
    function showToast(type, title, message) {
        // Remove any existing toasts
        $('.custom-toast').remove();
        
        // Create toast element
        const toast = $(`
            <div class="custom-toast position-fixed bottom-0 end-0 p-3" style="z-index: 11">
                <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header bg-${type === 'success' ? 'success' : 'danger'} text-white">
                        <strong class="me-auto">${title}</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body bg-light">
                        ${message}
                    </div>
                </div>
            </div>
        `);
        
        // Add to DOM
        $('body').append(toast);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            toast.remove();
        }, 5000);
        
        // Close button handler
        toast.find('.btn-close').on('click', function() {
            toast.remove();
        });
    }
});
</script>

</body>
</html>
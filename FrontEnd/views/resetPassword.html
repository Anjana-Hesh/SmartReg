<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="../assets/images/titleIcon.png" type="image/x-icon">
  <title>Reset Password - SmartReg.lk</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.10.5/sweetalert2.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/resetPassword.css">

</head>
<body>

<div class="container-fluid vh-100 d-flex align-items-center">
  <div class="row w-100">
    <div class="content-container">
      <div class="card-glass p-4">
        <div class="text-center mb-4">
          <i class="fas fa-lock text-warning mb-3" style="font-size: 3rem;"></i>
          <h2 class="fw-bold mb-2">Reset Password</h2>
          <p class="text-secondary">Create a new password for your account</p>
        </div>

        <form id="resetPasswordForm">
          <div class="mb-3">
            <label for="newPassword" class="form-label">
              <i class="fas fa-key me-2"></i>New Password
            </label>
            <div class="password-container">
              <input type="password" class="form-control form-control-glass" id="newPassword"
                     placeholder="Enter your new password" required>
              <button type="button" class="password-toggle" id="toggleNewPassword">
                <i class="fas fa-eye-slash"></i>
              </button>
            </div>
            <div class="password-strength">
              <div class="strength-meter" id="passwordStrength"></div>
            </div>
            <div id="passwordFeedback" class="feedback">Password must be at least 8 characters long</div>
          </div>

          <div class="mb-3">
            <label for="confirmPassword" class="form-label">
              <i class="fas fa-key me-2"></i>Confirm Password
            </label>
            <div class="password-container">
              <input type="password" class="form-control form-control-glass" id="confirmPassword"
                     placeholder="Re-enter your new password" required>
              <button type="button" class="password-toggle" id="toggleConfirmPassword">
                <i class="fas fa-eye-slash"></i>
              </button>
            </div>
            <div id="passwordMatchFeedback" class="feedback"></div>
          </div>

          <button type="submit" class="btn btn-primary-glass w-100 mb-3" id="resetBtn">
            <i class="fas fa-save me-2"></i>Reset Password
          </button>

          <div class="text-center">
            <a href="../index.html" class="text-primary text-decoration-none">
              <i class="fas fa-arrow-left me-2"></i>Back to Login
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.10.5/sweetalert2.all.min.js"></script>

<script>
  $(document).ready(function() {
    // Password toggle functionality
    $('#toggleNewPassword').click(function() {
      const $input = $('#newPassword');
      const $icon = $(this).find('i');

      if ($input.attr('type') === 'password') {
        $input.attr('type', 'text');
        $icon.removeClass('fa-eye-slash').addClass('fa-eye');
      } else {
        $input.attr('type', 'password');
        $icon.removeClass('fa-eye').addClass('fa-eye-slash');
      }
    });

    $('#toggleConfirmPassword').click(function() {
      const $input = $('#confirmPassword');
      const $icon = $(this).find('i');

      if ($input.attr('type') === 'password') {
        $input.attr('type', 'text');
        $icon.removeClass('fa-eye-slash').addClass('fa-eye');
      } else {
        $input.attr('type', 'password');
        $icon.removeClass('fa-eye').addClass('fa-eye-slash');
      }
    });

    function checkPasswordStrength(password) {
      let strength = 0;

      if (password.length >= 8) strength++;

      if (/[A-Z]/.test(password)) strength++;

      if (/[a-z]/.test(password)) strength++;

      if (/[0-9]/.test(password)) strength++;

      if (/[^A-Za-z0-9]/.test(password)) strength++;

      $('#passwordStrength').attr('class', 'strength-meter strength-' + strength);

      return strength;
    }

    // Password match checker
    function checkPasswordMatch() {
      const password = $('#newPassword').val();
      const confirmPassword = $('#confirmPassword').val();
      const $feedback = $('#passwordMatchFeedback');

      if (confirmPassword.length === 0) {
        $feedback.hide();
      } else if (password === confirmPassword) {
        $feedback.html('<i class="fas fa-check"></i> Passwords match').addClass('valid').removeClass('invalid').show();
      } else {
        $feedback.html('<i class="fas fa-times"></i> Passwords do not match').addClass('invalid').removeClass('valid').show();
      }
    }

    $('#newPassword').on('input', function() {
      const strength = checkPasswordStrength($(this).val());
      const $feedback = $('#passwordFeedback');

      if ($(this).val().length > 0) {
        $feedback.show();
      } else {
        $feedback.hide();
      }

      checkPasswordMatch();
    });

    $('#confirmPassword').on('input', checkPasswordMatch);

    // Form submission
    $('#resetPasswordForm').on('submit', async function(e) {
      e.preventDefault();

      const newPassword = $('#newPassword').val();
      const confirmPassword = $('#confirmPassword').val();

      // Validate password strength
      const strength = checkPasswordStrength(newPassword);
      if (strength < 3) {
        await Swal.fire({
          title: 'Weak Password',
          text: 'Please choose a stronger password that meets all requirements',
          icon: 'warning',
          confirmButtonColor: '#3085d6',
          confirmButtonText: 'OK'
        });
        return;
      }

      // Check password match
      if (newPassword !== confirmPassword) {
        await Swal.fire({
          title: 'Password Mismatch',
          text: 'The passwords you entered do not match',
          icon: 'error',
          confirmButtonColor: '#3085d6',
          confirmButtonText: 'OK'
        });
        return;
      }

      // Show loading state
      const $resetBtn = $('#resetBtn');
      $resetBtn.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Resetting...');
      $resetBtn.prop('disabled', true);

      // Simulate API call (replace with actual API call)
      setTimeout(() => {
        Swal.fire({
          title: 'Password Reset!',
          text: 'Your password has been successfully updated',
          icon: 'success',
          confirmButtonColor: '#28a745',
          confirmButtonText: 'Continue to Login',
          willClose: () => {
            window.location.href = 'login.html';
          }
        });

        // Reset button state (in case the user comes back)
        $resetBtn.html('<i class="fas fa-save me-2"></i> Reset Password');
        $resetBtn.prop('disabled', false);
      }, 1500);
    });
  });
</script>
</body>
</html>